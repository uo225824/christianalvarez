---
title: "Voice to image with functional regression"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

IMPORTANT: You can delete everything in here and start fresh. You might want to start by not deleting anything above this line until you know what that stuff is doing.


This is an .Rmd file. It is plain text with special features. Any time you write just like this, it will be compiled to normal text in the website. If you put a \# in front of your text, it will create a top level-header.

# Voice to image with functional regression

2020 | 07 | 23 Last compiled: `r Sys.Date()`

In this section our focus will be in find a way to implement the functional regression with functional response to the MNIST problem. Our goal will be to a make a model where the response is a handwritte number and the covariable a voice note of the number. Due to the computational cost of this model, we will focus on a simple case, using only the number zero.

##The voice data.

The first step in our analysis will be to study the behavior of our audio notes. We will represent two voice note using functional data.

```{r}
library(seawaveQ)
library(audio)
library(fda.usc)
library(stats)

#Loading the data audio of the spoken numbers
s0<-load.wave(where = "spoken/datos/0_jackson_0.wav")
s1<-load.wave(where = "spoken/datos/0_jackson_1.wav")

sc<-cbind(s0,s1)

#Making the functional data

nbx<-291
basisx <- create.fourier.basis(c(0,5148),nbasis = nbx )
fds<-Data2fd((sc),seq(0,5148,length=5148),basisobj = basisx)

par(mfrow=c(1,2))
plot(fds,main="Functional data approach",xlab="Time",
        ylab="Amplitude")
plot.ts(sc[,1],main="Real data",xlab="Time",
        ylab="Amplitude")
lines(sc[,2], col = "red")

```
We have used a 291 elements of the Fourier basis. It is a very large number of elements, and the approximation isn't as good as we expect. The problem here is that our data is very rough. We will make a discrete Fourier transform of the data (we want to work in frequency domain) to make easier the approximation. We will also work in absolute value for ease.

```{r}
#We make a fast discrete fourier transform 
s0t<-fft(s0)
s0t<-abs(s0t)
s1t<-fft(s1)
s1t<-abs(s1t)


sct<-cbind(s0t,s1t)

#Making the functional data

nbx<-291
basisx <- create.fourier.basis(c(0,5148),nbasis = nbx )
fdst<-Data2fd((sct),seq(0,5148,length=5148),basisobj = basisx)

par(mfrow=c(1,2))
plot(fdst,main="Functional data approach",xlab="Time",
        ylab="Amplitude")
plot.ts(sct[,1],main="Real data",xlab="Time",
        ylab="Amplitude")
lines(sct[,2], col = "red")




```

As we can see, the approximation is much better than the first attempt.


```{r}

temp = list.files(pattern="*wav")
myfiles = lapply(temp, load.wave)

M<-matrix(data=0,nrow = 50,ncol = 6273)
for (i in 1:50) {
 
  M[i,1:length(myfiles[[i]])]<-myfiles[[i]]
    
}

#Our functional covariable

x<-abs(t(fft(M)))
nbx<-291
basisx <- create.fourier.basis(c(0,6273),nbasis = nbx )
SFD<-Data2fd((x),seq(0,7038,length=7038),basisobj = basisx)




```

##The MNIST dataset.

The following image shows a set of handwritten  numbers from the MNIST data set.

![](images/mnist.png)



The dataset has 785 colums. The firts one indicates the value of the handwrite number and the next 784 the value of the pixels. This pixel form a 28x28 image.

```{r}
train<-read.csv(file = "datos/train.csv")
head(train)


```

We only will work with the number 0. Since we just have 50 voice note  of the number 0, we will only take 50 random 0 from the dataset.

```{r}
ii<-which(train$label==0)
index<-sample(ii,50)

#Our functional response model 

y <-t(train[index,2:ncol(train)])
nby<-199
basisy<-  create.fourier.basis(c(0,784),nbasis = nby )
DFD<-Data2fd((y),seq(0,784,length=784),basisobj = basisy)



```








I wrote an [introductory programming book that introduces R](https://crumplab.github.io/programmingforpsych/), and gives some [concrete problems for you to solve](https://crumplab.github.io/programmingforpsych/programming-challenges-i-learning-the-fundamentals.html). 









